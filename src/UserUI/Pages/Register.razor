@page "/register"
@using MudBlazor
@using UserUI.Services
@inject  AuthService Auth
@inject  NavigationManager Navigation



<MudPaper Class="pa-6 mx-auto mt-12" Elevation="4" Style="max-width:400px;">
    @if (!string.IsNullOrEmpty(message))
    {
        <MudText>@message</MudText>
    }
    <EditForm Model="registrationModel" OnValidSubmit="HandleRegistration">
        <DataAnnotationsValidator/>
        <ValidationSummary/>

        
        <MudTextField 
            Label="Username" 
            Required="true" 
            @bind-Value="registrationModel.Username" 
            Class="mb-2 compact-input"
            Variant="Variant.Outlined"/>
    
        <MudTextField 
            Label="Email" 
            Required="true" 
            @bind-Value="registrationModel.Email" 
            Class="mb-2 compact-input"
            Variant="Variant.Outlined"/>

        <MudTextField 
            Label="Password" 
            Required="true" 
            InputType="InputType.Password" 
            @bind-Value="registrationModel.Password" 
            Class="mb-2 compact-input"
            Variant="Variant.Outlined"/>

        
        <MudButton
            Align
            EndIcon="@Icons.Material.Filled.Login"
            ButtonType="ButtonType.Submit"
            Variant="Variant.Filled"
            FullWidth="true"
            Color="Color.Primary">
                Register
        </MudButton>
    </EditForm>
</MudPaper>


@code
{
    private RegistrationModel registrationModel = new ();
    private string message = string.Empty;
    public async Task HandleRegistration()
    {
        try
        {
            var register =  await Auth.RegisterAsync(registrationModel.Username, registrationModel.Email, registrationModel.Password);

            if (register != null)
            {
                message = "Registration Successful";
                await Task.Delay(1000);
                Navigation.NavigateTo("/");
            }
        }
        catch (Exception ex)
        {
            message = $"Registration Failed: {ex.Message}";
            Console.WriteLine($"Registration Failed: {ex.Message}");
        }
        
    }
    
    public class RegistrationModel
    {
        public string Username { get; set; } = "";
        public string Email { get; set; } = "";
        public string Password { get; set; } = "";
    }
}
